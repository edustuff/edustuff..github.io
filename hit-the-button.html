<!DOCTYPE html>
<html>
<head>
    <style>
.grid-container {
  display: grid;
  grid-template-columns: auto auto auto auto;
  background: rgba(24, 153, 218, 1);
}

* {
   font-family: sans-serif;
}

.grid-item {
  padding-top:30px;
  padding-bottom:30px;
  border-radius: 25px;
  background: rgb(240, 139, 37, 1);
  background: linear-gradient(45deg, rgba(240, 139, 37, 1) 0%, rgba(229, 63, 50, 1) 100%);
  border: 10px solid rgba(24, 153, 218, 1);
  font-size: 46px;
  text-align: center;
}

.container {
    background-color: rgba(25, 68, 146, 1);
}

body {
    background-color: rgba(25, 68, 146, 1);
}

button {
  margin-top: 20px;
  margin-button: 20px;
  padding-left: 20px;
  padding-right: 20px;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

#question {
  padding: 20px;
  color: #ff3;
  font-size: 92px;
  text-align: center;
  margin-top: 0px;
  margin-bottom: 0px;
}

#timeRemaining,#score,#finalScore {
  padding: 20px;
  color: #fff;
  font-size: 36px;
  text-align: center;
  margin-top: 0px;
  margin-bottom: 0px;
}

#gameScreen {
    position: absolute;
    top: 0px;
    width: 100%;
    visibility: hidden;
}

#startScreen {
    position: absolute;
    top: 0px;
    width: 100%;
}



</style>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="user-scalable=no, width=device-width" />
    <link rel="apple-touch-icon" href="Icon2dx.png" />

</head>

<script src="questions/indicies.js"></script>
<script src="questions/percentages.js"></script>

<script>

    var totalScore = 0;
    var timeRemaining = 60;
    var correctTotal = 0;
    var incorrectTotal = 0;
    var currentQuestionId = 0;
    var numberOfQuestions = 12;

    var timer;

    var questions = [];
    var uniqueAnswers = [];

    var maxType = 1;
    var curQuestionType = 1;


    function inverseQuestions(originalQuestions) {

        var inversedQuestions = [];

        for (i = 0; i < originalQuestions.length; i++) {
            inversedQuestions.push({type : originalQuestions[i].type, question : originalQuestions[i].answer, answer: originalQuestions[i].question});
        }

        return inversedQuestions;
    }


    function showStartScreen() {
        document.getElementById("startScreen").style.visibility= 'visible' ;
    }

    function hideStartScreen() {
        document.getElementById("startScreen").style.visibility= 'hidden' ;
    }

    function showGameScreen() {
        document.getElementById("gameScreen").style.visibility= 'visible' ;
    }

    function hideGameScreen() {
        document.getElementById("gameScreen").style.visibility= 'hidden' ;
    }

    function initialiseGame(questionData) {

        questions = questionData;
        uniqueAnswers = [];

        totalScore = 0;
        timeRemaining = 60;
        correctTotal = 0;
        incorrectTotal = 0;
        maxType = 1;
        curQuestionType = 1;

        shuffle(questions);
        setAnswers();

        hideStartScreen();
        showGameScreen();
        updateRemainingTime();

        if (!timer) {
            startTimer();
        }

        pickRandomQuestion();

    }

    function endGame() {

        hideGameScreen();
        showStartScreen();
        updateFinalScore();

    }

    function startTimer() {

        timer = setInterval(function(){
            timeRemaining = timeRemaining - 1;
            updateRemainingTime();
            if (timeRemaining == 0) {
                endGame();
            }
        },1000);

    }

    function updateRemainingTime() {
        document.getElementById("timeRemaining").innerHTML = "Timer: " + timeRemaining;
    }

    function updateFinalScore() {
        var total = correctTotal + incorrectTotal;
        document.getElementById("finalScore").innerHTML = "You scored " + correctTotal + " out of " + total + ".";
    }

    function setAnswers() {

        uniqueAnswers = [];
        uniqueQuestions = [];

        var uniqueAnswerIndex = 0;

        maxType = 1;

        for (i = 0; i < questions.length; i++) {
            if (questions[i].type > maxType) {
                maxType = questions[i].type;
            }
        }

        var curType = 1;

        var i=0;

        while (uniqueAnswerIndex < numberOfQuestions) {

            if (questions[i].type == curType && uniqueAnswers.indexOf(questions[i].answer) == -1 && uniqueQuestions.indexOf(questions[i].question) == -1) {

                uniqueAnswers.push(questions[i].answer);
                uniqueQuestions.push(questions[i].question);

                document.getElementById(uniqueAnswerIndex).innerHTML = questions[i].answer;
                document.getElementById(uniqueAnswerIndex).setAttribute("questionid", i);
                document.getElementById(uniqueAnswerIndex).onclick = function(){checkAnswer(event)};

                uniqueAnswerIndex++;

                curType++;

                if (curType > maxType) {
                    curType = 1;
                }

            }

            i++;
            if (i == questions.length) {
                i = 0;
            }
        }

    }



    function pickRandomQuestion() {

        var newQuestionId = currentQuestionId;

        while (questions[newQuestionId].type != curQuestionType || currentQuestionId == newQuestionId || !uniqueAnswers.includes(questions[newQuestionId].answer)) {
            newQuestionId = Math.floor(Math.random()*questions.length);
        }

        curQuestionType++;
        if (curQuestionType > maxType) {
            curQuestionType = 1;
        }

        currentQuestionId = newQuestionId;
        currentQuestion = questions[currentQuestionId];

        document.getElementById("question").innerHTML = currentQuestion.question;
    }

    function checkAnswer(event) {
        questionId = event.target.getAttribute("questionid");

        //alert(questionId + "," + currentQuestionId);

        providedAnswer = questions[questionId].answer;
        correctAnswer = questions[currentQuestionId].answer;

        isCorrect = providedAnswer == correctAnswer;

        if (isCorrect) {
            correctTotal++;
            flashColour(event.target, "green");
        } else {
            incorrectTotal++;
            flashColour(event.target, "red");
        }

        //alert(providedAnswer + "," + correctAnswer + "," + isCorrect);

        updateScore();

        pickRandomQuestion();
    }

    function flashColour(element, colour) {
        var existingColour = element.style.background;
        element.style.background = colour;
         setTimeout(function(){
            element.style.background = existingColour;
        },300);
    }

    function updateScore() {
        var total = correctTotal + incorrectTotal;
        document.getElementById("score").innerHTML = "Score: " + correctTotal + "/" + total;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1)); // random index from 0 to i

        // swap elements array[i] and array[j]
        // we use "destructuring assignment" syntax to achieve that
        // you'll find more details about that syntax in later chapters
        // same can be written as:
        // let t = array[i]; array[i] = array[j]; array[j] = t
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

</script>

<body>

<div id="startScreen">
    <p id="finalScore"></p>
    <button class="grid-item" onclick="initialiseGame(getIndiciesQuestions());">Squares, Cubes and Other Indices 1</button>
    <button class="grid-item" onclick="initialiseGame(inverseQuestions(getIndiciesQuestions()));">Squares, Cubes and Other Indices 2</button>
    <button class="grid-item" onclick="initialiseGame(getPercentageQuestions());">Percentages 1</button>
    <button class="grid-item" onclick="initialiseGame(inverseQuestions(getPercentageQuestions()));">Percentages 2</button>
</div>

<div id="gameScreen">

<div class="container">
<p id="question">-</p>
</div>

<div class="grid-container">
    <div id="0" class="grid-item"></div>
    <div id="1" class="grid-item"></div>
    <div id="2" class="grid-item"></div>
    <div id="3" class="grid-item"></div>
    <div id="4" class="grid-item"></div>
    <div id="5" class="grid-item"></div>
    <div id="6" class="grid-item"></div>
    <div id="7" class="grid-item"></div>
    <div id="8" class="grid-item"></div>
    <div id="9" class="grid-item"></div>
    <div id="10" class="grid-item"></div>
    <div id="11" class="grid-item"></div>
</div>

<div class="container">
<p id="timeRemaining">Timer:</p>
<p id="score">Score:</p>
</div>
</div>


</body>
</html>
